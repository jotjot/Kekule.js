define("local_kekulejs/kekuleChemViewerInterceptor",["kekule"],(function(){function init(){if("undefined"!=typeof Kekule){var KekuleQuizReportInterceptor={matchPage:function(document){var url=document.location.pathname.toLowerCase();return!!(url.match("quiz")||url.match("question"))},getTargetElements:function(document){var result=[].concat(Array.prototype.slice.call(document.body.querySelectorAll('td[id^="mod-quiz-report-statistics-question-table"]')||[],0));return result=(result=result.concat(Array.prototype.slice.call(document.body.querySelectorAll('div[class^="responsehistoryheader"] tbody tr td')||[],0))).concat(Array.prototype.slice.call(document.body.querySelectorAll('div[id^="techinfo_inner"] p')||[],0))},_extractMolJsonInfo:function(content){var startPos=content.indexOf('{"'),endPos=content.lastIndexOf('"}');if(startPos>=0&&endPos>=content.length-3){for(var nonJsonContent=content.substring(0,startPos),jsonContent=content.substring(startPos,endPos+2),jsonStrs=[],currStartPos=0,sepPos=jsonContent.indexOf('"}; {"',currStartPos);sepPos>=0;){var currJsonStr=jsonContent.substring(currStartPos,sepPos+2);jsonStrs.push(currJsonStr),currStartPos=sepPos+4,sepPos=jsonContent.indexOf('"}; {"',currStartPos)}return jsonStrs.push(jsonContent.substring(currStartPos,endPos+2)),{nonJsonContent:nonJsonContent,jsonContents:jsonStrs}}return null},handleElement:function(element){var children=Kekule.DomUtils.getChildNodesOfTypes(element,Node.TEXT_NODE);if(1===children.length&&!Kekule.DomUtils.getChildNodesOfTypes(element,Node.ELEMENT_NODE).length){var content=(children[0].nodeValue||"").trim(),molJsonContentInfo=KekuleQuizReportInterceptor._extractMolJsonInfo(content);if(molJsonContentInfo){Kekule.DomUtils.clearChildContent(element),molJsonContentInfo.nonJsonContent&&Kekule.DomUtils.setElementText(element,molJsonContentInfo.nonJsonContent);for(var i=0,l=molJsonContentInfo.jsonContents.length;i<l;++i){var jsonStr=molJsonContentInfo.jsonContents[i],currViewer=null;try{var jsonObj=JSON.parse(jsonStr);if(jsonObj&&jsonObj.molData){var chemObj=Kekule.IO.loadFormatData(jsonObj.molData,Kekule.IO.DataFormat.KEKULE_JSON);if(chemObj){var viewer=new Kekule.ChemWidget.Viewer2D(element.ownerDocument);viewer.setPredefinedSetting("basic"),viewer.appendToElem(element),viewer.load(chemObj),currViewer=viewer}}}catch(e){}if(!currViewer){var textNode=element.ownerDocument.createTextNode(jsonStr);element.appendChild(textNode)}}}}},execute:function(doc){if(doc||(doc=document),KekuleQuizReportInterceptor.matchPage(doc)){var targetElems=KekuleQuizReportInterceptor.getTargetElements(doc);if(targetElems)for(var i=targetElems.length-1;i>=0;--i)KekuleQuizReportInterceptor.handleElement(targetElems[i])}}};Kekule.X.domReady(KekuleQuizReportInterceptor.execute)}}return{init:function(){Kekule._ready(init)}}}));

//# sourceMappingURL=kekuleChemViewerInterceptor.min.js.map