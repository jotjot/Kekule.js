define("local_kekulejs/kekuleMoodle",["kekule","local_kekulejs/kekuleInitials"],(function(){function init(){var root=window,KekuleMoodle={WidgetDataWrapper:{WRAPPER_HTML_CLASS:"KekuleMoodle-Widget-Data-Wrapper",WRAPPER_DATA_HTML_CLASS:"KekuleMoodle-Widget-Data",ALLOWED_TAGNAMES:["div","span","img","p","section"],ALLOWED_ATTRIBS:["class","style","id","name","width","height",/^data-/],_matchAttribPatterns:function(attribName,patterns){for(var i=0,l=patterns.length;i<l;++i)if(attribName.match(patterns[i]))return!0;return!1},convertWrapperElem:function(elem,autoLaunchWidget){var content=Kekule.HtmlElementUtils.getInnerText(elem);try{var jsonObj=JSON.parse(content);if(jsonObj){var tagName=jsonObj.tagName||elem.tagName;if(KekuleMoodle.WidgetDataWrapper.ALLOWED_TAGNAMES.indexOf(tagName.toLowerCase())<0)return null;Kekule.DomUtils.clearChildContent(elem);var targetElem=elem,newCreated=!1;for(var attrib in jsonObj.tagName&&(targetElem=elem.ownerDocument.createElement(jsonObj.tagName),newCreated=!0),jsonObj)if("tagName"!==attrib&&KekuleMoodle.WidgetDataWrapper._matchAttribPatterns(attrib,KekuleMoodle.WidgetDataWrapper.ALLOWED_ATTRIBS)){var value=jsonObj[attrib];targetElem.setAttribute(attrib,value)}Kekule.HtmlElementUtils.removeClass(elem,KekuleMoodle.WidgetDataWrapper.WRAPPER_HTML_CLASS),newCreated&&elem.appendChild(targetElem),autoLaunchWidget&&Kekule.Widget.autoLauncher.execute(targetElem)}}catch(e){}},launchOnElem:function(elem){if(!elem.isContentEditable&&!Kekule.Widget.getWidgetOnElem(elem,!0))if(Kekule.HtmlElementUtils.hasClass(elem,KekuleMoodle.WidgetDataWrapper.WRAPPER_HTML_CLASS))KekuleMoodle.WidgetDataWrapper.convertWrapperElem(elem,!0);else for(var children=Kekule.DomUtils.getDirectChildElems(elem),i=0,l=children.length;i<l;++i){var child=children[i];this.launchOnElem(child)}},launchOnDoc:function(doc){doc||(doc=document),KekuleMoodle.WidgetDataWrapper.launchOnElem(doc.body)}}};root.KekuleMoodle=KekuleMoodle,Kekule.X.domReady((function(){KekuleMoodle.WidgetDataWrapper.launchOnDoc(document)}))}return{init:function(){Kekule._ready(init)}}}));

//# sourceMappingURL=kekuleMoodle.min.js.map