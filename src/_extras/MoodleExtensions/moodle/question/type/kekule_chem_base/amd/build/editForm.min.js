define("qtype_kekule_chem_base/editForm",["kekule"],(function(){function init(){function createChemViewer(placeHolder,molData,molDataType,className,inputType){var BNS=Kekule.ChemWidget.ComponentWidgetNames,ansIndex=(placeHolder.name,function(elem){var result=-1,matchResult=elem.name.match(/\[(\d+)\]/);matchResult&&(result=parseInt(matchResult[1]));return result}(placeHolder));if(ansIndex>=0){var widgetProps={};"1"===inputType?(widgetProps.restrainEditorWithCurrObj=!1,widgetProps.editorProperties={allowCreateNewChild:!0}):(widgetProps.restrainEditorWithCurrObj=!0,widgetProps.editorProperties={predefinedSetting:"molOnly",allowCreateNewChild:!1});var container=document.createElement("span"),linebreak=document.createElement("br"),parentElem=placeHolder.parentNode;parentElem.insertBefore(container,placeHolder),parentElem.insertBefore(linebreak,placeHolder),placeHolder.style.display="none";var result=new Kekule.ChemWidget.Viewer(container);if(result.setPropValues(widgetProps),result.setPredefinedSetting("editOnly").setToolButtons([BNS.loadData,BNS.saveData,BNS.openEditor]).setResizable(!0).setEnableEditFromVoid(!0),className&&result.addClassName(className),molData){var dataType=molDataType||Kekule.IO.MimeType.KEKULE_JSON;try{var chemObj=Kekule.IO.loadMimeData(molData,dataType);chemObj&&result.setChemObj(chemObj)}catch(e){console.error(e)}}result.__inputType__=inputType,result.__answerIndex__=ansIndex;var ansRelElems=function(ansIndex){return{answer:document.getElementsByName("answer["+ansIndex+"]")[0]}}(ansIndex);return result.__answerRelElems__=ansRelElems,result.on("load",reactChemObjLoad),result}return null}function reactChemObjLoad(e){var viewer=e.currentTarget||e.target;if(viewer instanceof Kekule.ChemWidget.Viewer){viewer.getElement();var answerElem=viewer.__answerRelElems__.answer;if(answerElem){var molData="",smiles="",smilesNoStereo="",chemObj=viewer.getChemObj();if(chemObj){var sAnswer="";if(chemObj.isEmpty&&chemObj.isEmpty()||chemObj instanceof Kekule.ChemDocument&&chemObj.getChildCount()<=0)sAnswer="";else if(chemObj.isEmpty())sAnswer="";else{try{molData=Kekule.IO.saveMimeData(chemObj,Kekule.IO.MimeType.KEKULE_JSON),smiles=Kekule.IO.saveMimeData(chemObj,Kekule.IO.MimeType.SMILES,{ignoreStereo:!1}),smilesNoStereo=Kekule.IO.saveMimeData(chemObj,Kekule.IO.MimeType.SMILES,{ignoreStereo:!0})}catch(e){}var saveObj={smiles:smiles,smilesNoStereo:smilesNoStereo,molDataType:Kekule.IO.MimeType.KEKULE_JSON,molData:molData};sAnswer=JSON.stringify(saveObj)}}answerElem.value=sAnswer}}}Kekule.X.domReady((function(){Kekule.Editor.ChemSpaceEditorConfigs&&Kekule.Editor.ChemSpaceEditorConfigs.getInstance&&Kekule.Editor.ChemSpaceEditorConfigs.getInstance().getInteractionConfigs().setAllowUnknownAtomSymbol(!1),function(placeHolderElems){for(var inputType=function(placeHolderElems){var result=null,elem=placeHolderElems[0],form=elem&&elem.form;if(form){var inputTypeElem=form.elements.inputtype;result=inputTypeElem&&inputTypeElem.value}return result}(placeHolderElems),i=0,l=placeHolderElems.length;i<l;++i){var placeHolder=placeHolderElems[i],ansData=placeHolder.value,molData=null,molDataType=null;if(ansData)try{var ansJSON=JSON.parse(ansData);molData=ansJSON.molData,molDataType=ansJSON.molDataType}catch(e){}var className=placeHolder.getAttribute("data-widget-class");createChemViewer(placeHolder,molData,molDataType,className,inputType)}}(function(){for(var result=[],elems=document.getElementsByTagName("textarea"),i=0,l=elems.length;i<l;++i){var className=elems[i].className;className&&className.indexOf("K-Chem-Question-Design-AnswerBlank")>=0&&result.push(elems[i])}return result}())}))}return{init:function(){Kekule._ready(init)}}}));

//# sourceMappingURL=editForm.min.js.map