{"version":3,"file":"extraWidgets.min.js","sources":["../src/extraWidgets.js"],"sourcesContent":["define(/*'qtype_kekule_chem_base/extraWidgets',*/ ['kekule', 'local_kekulejs/kekuleMoodle'], function(){\r\n\r\nfunction init() {\r\n\r\n\tif (typeof (KekuleMoodle) === 'undefined')\r\n\t\tKekuleMoodle = {};\r\n\tif (!KekuleMoodle.Widget)\r\n\t\tKekuleMoodle.Widget = {};\r\n\r\n\tKekuleMoodle.Widget.ChemObjSelectorPanel = Class.create(Kekule.Widget.Panel, {\r\n\t\tCLASS_NAME: 'KekuleMoodle.Widget.ChemObjSelectorPanel',\r\n\t\tinitialize: function (/*$super, */parentOrElementOrDocument, renderType, viewerConfigs) {\r\n\t\t\t//this.setPropStoreFieldValue('renderType', renderType);\r\n\t\t\t//this.setPropStoreFieldValue('viewerConfigs', viewerConfigs);\r\n\t\t\tthis.tryApplySuper('initialize', [parentOrElementOrDocument]);\r\n\t\t\tthis._renderConfigs = this._generateDefaultRenderConfigs();\r\n\t\t\tvar viewerGrid = new Kekule.ChemWidget.ViewerGrid(this, renderType, viewerConfigs);\r\n\t\t\tviewerGrid.setEnableAdd(false).setEnableRemove(false);\r\n\t\t\tthis.setPropStoreFieldValue('viewerGrid', viewerGrid);\r\n\t\t\tthis.on('click', this.reactCellClick.bind(this));\r\n\t\t},\r\n\t\tinitProperties: function () {\r\n\t\t\tthis.defineProp('objects', {\r\n\t\t\t\t'dataType': DataType.ARRAY, 'serializable': false,\r\n\t\t\t\t'setter': function (value) {\r\n\t\t\t\t\tthis.setPropStoreFieldValue('objects', value || []);\r\n\t\t\t\t\tthis.objectsChanged();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t//this.defineProp('renderType', {'dataType': DataType.INT, 'serializable': false, 'setter': null});\r\n\t\t\t//this.defineProp('viewerConfigs', {'dataType': DataType.OBJECT, 'serializable': false, 'setter': null});\r\n\r\n\t\t\t// private\r\n\t\t\tthis.defineProp('viewerGrid', {'dataType': DataType.OBJECT, 'serializable': false, 'setter': null});\r\n\t\t},\r\n\t\tdoFinalize: function () {\r\n\t\t\tthis.getViewerGrid().finalize();\r\n\t\t\tthis.tryApplySuper('doFinalize');\r\n\t\t},\r\n\r\n\t\t/** @ignore */\r\n\t\tdoGetWidgetClassName: function (/*$super*/) {\r\n\t\t\treturn this.tryApplySuper('doGetWidgetClassName') + ' ' + 'KM-ChemObjSelectorPanel';\r\n\t\t},\r\n\r\n\t\t_generateDefaultRenderConfigs: function () {\r\n\t\t\tvar result = new Kekule.Render.Render2DConfigs();\r\n\t\t\tresult.getLengthConfigs().setAutofitContextPadding(10);\r\n\t\t\t//result.getLengthConfigs().setBondLineWidth(4);\r\n\t\t\treturn result;\r\n\t\t},\r\n\r\n\t\tobjectsChanged: function ()  // update viewers to reflect to objects change\r\n\t\t{\r\n\t\t\tvar objs = this.getObjects();\r\n\t\t\tvar grid = this.getViewerGrid();\r\n\t\t\tgrid.clearWidgets();\r\n\t\t\tfor (var i = 0, l = objs.length; i < l; ++i) {\r\n\t\t\t\tgrid.addChemObj(objs[i]);\r\n\t\t\t}\r\n\t\t\tvar viewers = grid.getChildWidgets();\r\n\t\t\tfor (var i = 0, l = viewers.length; i < l; ++i) {\r\n\t\t\t\tviewers[i].beginUpdate();\r\n\t\t\t\tviewers[i].setAutoShrink(true);\r\n\t\t\t\tviewers[i].setRenderConfigs(this._renderConfigs);\r\n\t\t\t\tviewers[i].setPadding(this._renderConfigs.getLengthConfigs().getAutofitContextPadding());\r\n\t\t\t\tviewers[i].endUpdate();\r\n\t\t\t\t//viewers[i].repaint();\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\t_getTargetViewer: function (srcWidget) {\r\n\t\t\tif (srcWidget instanceof Kekule.ChemWidget.Viewer && srcWidget.getParent() === this.getViewerGrid()) {\r\n\t\t\t\treturn srcWidget;\r\n\t\t\t} else {\r\n\t\t\t\tvar parent = srcWidget.getParent();\r\n\t\t\t\treturn parent ? this._getTargetViewer(parent) : null;\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\treactCellClick: function (e) {\r\n\t\t\tvar viewer = this._getTargetViewer(e.target);\r\n\t\t\tif (viewer)  // click on viewer\r\n\t\t\t{\r\n\t\t\t\tthis.invokeEvent('select', {'viewer': viewer, 'chemObj': viewer.getChemObj()});\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n}\r\n\r\nreturn {\r\n\t'init': function(){\r\n\t\tKekule._ready(init);\r\n\t}\r\n};\r\n\r\n});"],"names":["define","init","KekuleMoodle","Widget","ChemObjSelectorPanel","Class","create","Kekule","Panel","CLASS_NAME","initialize","parentOrElementOrDocument","renderType","viewerConfigs","tryApplySuper","_renderConfigs","this","_generateDefaultRenderConfigs","viewerGrid","ChemWidget","ViewerGrid","setEnableAdd","setEnableRemove","setPropStoreFieldValue","on","reactCellClick","bind","initProperties","defineProp","DataType","ARRAY","value","objectsChanged","OBJECT","doFinalize","getViewerGrid","finalize","doGetWidgetClassName","result","Render","Render2DConfigs","getLengthConfigs","setAutofitContextPadding","objs","getObjects","grid","clearWidgets","i","l","length","addChemObj","viewers","getChildWidgets","beginUpdate","setAutoShrink","setRenderConfigs","setPadding","getAutofitContextPadding","endUpdate","_getTargetViewer","srcWidget","Viewer","getParent","parent","e","viewer","target","invokeEvent","getChemObj","_ready"],"mappings":"AAAAA,6CAAkD,CAAC,SAAU,gCAAgC,oBAEpFC,OAEsB,oBAAlBC,eACXA,aAAe,IACXA,aAAaC,SACjBD,aAAaC,OAAS,IAEvBD,aAAaC,OAAOC,qBAAuBC,MAAMC,OAAOC,OAAOJ,OAAOK,MAAO,CAC5EC,WAAY,2CACZC,WAAY,SAAsBC,0BAA2BC,WAAYC,oBAGnEC,cAAc,aAAc,CAACH,iCAC7BI,eAAiBC,KAAKC,oCACvBC,WAAa,IAAIX,OAAOY,WAAWC,WAAWJ,KAAMJ,WAAYC,eACpEK,WAAWG,cAAa,GAAOC,iBAAgB,QAC1CC,uBAAuB,aAAcL,iBACrCM,GAAG,QAASR,KAAKS,eAAeC,KAAKV,QAE3CW,eAAgB,gBACVC,WAAW,UAAW,UACdC,SAASC,oBAAuB,SAClC,SAAUC,YACdR,uBAAuB,UAAWQ,OAAS,SAC3CC,yBAOFJ,WAAW,aAAc,UAAaC,SAASI,qBAAwB,SAAiB,QAE9FC,WAAY,gBACNC,gBAAgBC,gBAChBtB,cAAc,eAIpBuB,qBAAsB,kBACdrB,KAAKF,cAAc,wBAAnBE,4BAGRC,8BAA+B,eAC1BqB,OAAS,IAAI/B,OAAOgC,OAAOC,uBAC/BF,OAAOG,mBAAmBC,yBAAyB,IAE5CJ,QAGRN,eAAgB,eAEXW,KAAO3B,KAAK4B,aACZC,KAAO7B,KAAKmB,gBAChBU,KAAKC,mBACA,IAAIC,EAAI,EAAGC,EAAIL,KAAKM,OAAQF,EAAIC,IAAKD,EACzCF,KAAKK,WAAWP,KAAKI,QAElBI,QAAUN,KAAKO,sBACVL,EAAI,EAAGC,EAAIG,QAAQF,OAAQF,EAAIC,IAAKD,EAC5CI,QAAQJ,GAAGM,cACXF,QAAQJ,GAAGO,eAAc,GACzBH,QAAQJ,GAAGQ,iBAAiBvC,KAAKD,gBACjCoC,QAAQJ,GAAGS,WAAWxC,KAAKD,eAAe0B,mBAAmBgB,4BAC7DN,QAAQJ,GAAGW,aAKbC,iBAAkB,SAAUC,cACvBA,qBAAqBrD,OAAOY,WAAW0C,QAAUD,UAAUE,cAAgB9C,KAAKmB,uBAC5EyB,cAEHG,OAASH,UAAUE,mBAChBC,OAAS/C,KAAK2C,iBAAiBI,QAAU,MAIlDtC,eAAgB,SAAUuC,OACrBC,OAASjD,KAAK2C,iBAAiBK,EAAEE,QACjCD,aAEEE,YAAY,SAAU,QAAWF,eAAmBA,OAAOG,wBAO7D,MACE,WACP7D,OAAO8D,OAAOpE"}