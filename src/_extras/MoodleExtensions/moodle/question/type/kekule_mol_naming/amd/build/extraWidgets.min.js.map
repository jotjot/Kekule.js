{"version":3,"file":"extraWidgets.min.js","sources":["../src/extraWidgets.js"],"sourcesContent":["define(/*'qtype_kekule_mol_naming/extraWidgets',*/ ['kekule', 'local_kekulejs/kekuleMoodle'], function(){\r\n\r\n\tfunction init() {\r\n\r\n\t\tif (typeof(Kekule) === 'undefined' || typeof(Kekule.Widget) == 'undefined')\r\n\t\t\treturn;\r\n\r\n\t\tif (typeof (KekuleMoodle) === 'undefined')\r\n\t\t\tKekuleMoodle = {};\r\n\t\tif (!KekuleMoodle.Widget)\r\n\t\t\tKekuleMoodle.Widget = {};\r\n\r\n\t\tKekuleMoodle.Widget.CharSelectorPanel = Class.create(Kekule.Widget.Panel, {\r\n\t\t\tCLASS_NAME: 'KekuleMoodle.Widget.CharSelectorPanel',\r\n\t\t\tinitialize: function (parentOrElementOrDocument) {\r\n\t\t\t\tthis.setPropStoreFieldValue('groupDelimiter', '\\n');\r\n\t\t\t\tthis.setPropStoreFieldValue('charDelimiter', ' ');\r\n\t\t\t\tthis.tryApplySuper('initialize', [parentOrElementOrDocument]);\r\n\t\t\t},\r\n\t\t\tinitProperties: function () {\r\n\t\t\t\t// chars need to be displayed in panel\r\n\t\t\t\tthis.defineProp('chars', {\r\n\t\t\t\t\t'dataType': DataType.STRING,\r\n\t\t\t\t\t'setter': function (value) {\r\n\t\t\t\t\t\tthis.setPropStoreFieldValue('chars', value || []);\r\n\t\t\t\t\t\tthis.charsChanged();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis.defineProp('groupDelimiter', {\r\n\t\t\t\t\t'dataType': DataType.STRING,\r\n\t\t\t\t\t'setter': function (value) {\r\n\t\t\t\t\t\tthis.setPropStoreFieldValue('groupDelimiter', value || []);\r\n\t\t\t\t\t\tthis.charsChanged();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis.defineProp('charDelimiter', {\r\n\t\t\t\t\t'dataType': DataType.STRING,\r\n\t\t\t\t\t'setter': function (value) {\r\n\t\t\t\t\t\tthis.setPropStoreFieldValue('charDelimiter', value || []);\r\n\t\t\t\t\t\tthis.charsChanged();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tdoFinalize: function () {\r\n\t\t\t\tthis.tryApplySuper('doFinalize');\r\n\t\t\t},\r\n\t\t\t/** @ignore */\r\n\t\t\tdoGetWidgetClassName: function (/*$super*/) {\r\n\t\t\t\treturn this.tryApplySuper('doGetWidgetClassName') + ' ' + 'KM-CharSelectorPanel';\r\n\t\t\t},\r\n\r\n\t\t\t/** @private */\r\n\t\t\tcharsChanged: function ()  // update the whole panel\r\n\t\t\t{\r\n\t\t\t\tthis._createCharContent(this.getDocument(), this.getChildrenHolderElement());\r\n\t\t\t},\r\n\t\t\t/** @private */\r\n\t\t\t_getCharGroups: function(charContent)\r\n\t\t\t{\r\n\t\t\t\tvar groupDelimiter = this.getGroupDelimiter();\r\n\t\t\t\tvar charDelimiter = this.getCharDelimiter();\r\n\t\t\t\tvar lines = (charContent || '').split(groupDelimiter);\r\n\r\n\t\t\t\tvar result = [];\r\n\t\t\t\tfor (var i = 0, l = lines.length; i < l; ++i)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar chars = lines[i].split(charDelimiter);\r\n\t\t\t\t\tresult.push(chars);\r\n\t\t\t\t}\r\n\t\t\t\treturn result;\r\n\t\t\t},\r\n\r\n\t\t\t/** @ignore */\r\n\t\t\tdoCreateSubElements: function(/*$super, */doc, rootElem)\r\n\t\t\t{\r\n\t\t\t\tthis._createCharContent(doc, rootElem);\r\n\t\t\t},\r\n\t\t\t/** @private */\r\n\t\t\t_createCharContent: function(doc, parentElem)\r\n\t\t\t{\r\n\t\t\t\tif (this._charContentELem)  // release old\r\n\t\t\t\t\tthis._charContentELem.parentNode.removeChild(this._charContentELem);\r\n\r\n\t\t\t\tvar charGroups = this._getCharGroups(this.getChars());\r\n\t\t\t\tvar result = doc.createElement('div');\r\n\t\t\t\tfor (var i = 0, ii = charGroups.length; i < ii; ++i)\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!charGroups[i].length)\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\tvar groupElem = doc.createElement('p');\r\n\t\t\t\t\tfor (var j = 0, jj = charGroups[i].length; j < jj; ++j)\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tvar s = (charGroups[i][j] || '').trim();\r\n\t\t\t\t\t\tif (s)\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvar charElem = doc.createElement('span');\r\n\t\t\t\t\t\t\tcharElem.innerHTML = s;\r\n\t\t\t\t\t\t\tgroupElem.appendChild(charElem);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tresult.appendChild(groupElem);\r\n\t\t\t\t}\r\n\t\t\t\tparentElem.appendChild(result);\r\n\t\t\t\tthis._charContentELem = result;\r\n\t\t\t\tKekule.X.Event.addListener(this._charContentELem, 'click', this._reactCellClick.bind(this));\r\n\t\t\t\treturn result;\r\n\t\t\t},\r\n\r\n\t\t\t_reactCellClick: function (e) {\r\n\t\t\t\t{\r\n\t\t\t\t\tvar elem = e.getTarget();\r\n\t\t\t\t\tif (elem.tagName.toLowerCase() === 'span')\r\n\t\t\t\t\t\tthis.invokeEvent('valueChange', {'value': elem.innerText});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tKekuleMoodle.Widget.CharSelectorGropButton = Class.create(Kekule.Widget.DropDownButton,\r\n\t\t\t/** @lends Kekule.Moodle.Widget.CharSelectorGropButton# */\r\n\t\t\t{\r\n\t\t\t\t/** @private */\r\n\t\t\t\tCLASS_NAME: 'KekuleMoodle.Widget.CharSelectorGropButton',\r\n\t\t\t\t/** @constructs */\r\n\t\t\t\tinitialize: function (parentOrElementOrDocument)\r\n\t\t\t\t{\r\n\t\t\t\t\tthis.setPropStoreFieldValue('groupDelimiter', '\\n');\r\n\t\t\t\t\tthis.setPropStoreFieldValue('charDelimiter', ' ');\r\n\t\t\t\t\tthis.tryApplySuper('initialize', [parentOrElementOrDocument])\r\n\t\t\t\t\tthis.setButtonKind(Kekule.Widget.Button.Kinds.DROPDOWN);\r\n\t\t\t\t},\r\n\t\t\t\tinitProperties: function () {\r\n\t\t\t\t\tthis.defineProp('chars', {'dataType': DataType.STRING});\r\n\t\t\t\t\tthis.defineProp('groupDelimiter', {'dataType': DataType.STRING});\r\n\t\t\t\t\tthis.defineProp('charDelimiter', {'dataType': DataType.STRING});\r\n\t\t\t\t\tthis.defineProp('selector', {'dataType': 'KekuleMoodle.Widget.CharSelectorPanel', 'setter': null, 'serializable': false,\r\n\t\t\t\t\t\t'scope': Class.PropertyScope.PUBLIC,\r\n\t\t\t\t\t\t'getter': function()\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvar result = this.getPropStoreFieldValue('selector');\r\n\t\t\t\t\t\t\tif (!result)\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\tresult = new KekuleMoodle.Widget.CharSelectorPanel(this);\r\n\t\t\t\t\t\t\t\t//console.log(result.getClassName(), result);\r\n\t\t\t\t\t\t\t\tresult.setPropStoreFieldValue('groupDelimiter', this.getGroupDelimiter());\r\n\t\t\t\t\t\t\t\tresult.setPropStoreFieldValue('charDelimiter', this.getCharDelimiter());\r\n\t\t\t\t\t\t\t\tresult.setChars(this.getChars());  // update result\r\n\t\t\t\t\t\t\t\tresult.setDisplayed(false);\r\n\t\t\t\t\t\t\t\tresult.getElement().style.position = 'absolute';  // important, do not affect normal content flow\r\n\t\t\t\t\t\t\t\tresult.addEventListener('valueChange', this.reactPanelValueChange, this);\r\n\t\t\t\t\t\t\t\tthis.setPropStoreFieldValue('selector', result);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn result;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t\tdoFinalize: function(/*$super*/)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar selector = this.getPropStoreFieldValue('selector');\r\n\t\t\t\t\tif (selector)\r\n\t\t\t\t\t\tselector.finalize();\r\n\t\t\t\t\tthis.tryApplySuper('doFinalize')  /* $super() */;\r\n\t\t\t\t},\r\n\t\t\t\t/** @ignore */\r\n\t\t\t\tdoGetWidgetClassName: function(/*$super*/)\r\n\t\t\t\t{\r\n\t\t\t\t\treturn this.tryApplySuper('doGetWidgetClassName')  + ' KM-CharSelectorGroupButton';\r\n\t\t\t\t},\r\n\t\t\t\t/** @ignore */\r\n\t\t\t\tdoGetDropDownWidget: function()\r\n\t\t\t\t{\r\n\t\t\t\t\treturn this.getSelector();\r\n\t\t\t\t},\r\n\r\n\t\t\t\t/** @private */\r\n\t\t\t\treactPanelValueChange: function(e)\r\n\t\t\t\t{\r\n\t\t\t\t\tvar value = e.value;\r\n\t\t\t\t\tthis.invokeEvent('valueChange', {'value': value});\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t}\r\n\r\n\treturn {\r\n\t\t'init': function(){\r\n\t\t\tKekule._ready(init);\r\n\t\t}\r\n\t};\r\n\r\n});"],"names":["define","init","Kekule","Widget","KekuleMoodle","CharSelectorPanel","Class","create","Panel","CLASS_NAME","initialize","parentOrElementOrDocument","setPropStoreFieldValue","tryApplySuper","initProperties","defineProp","DataType","STRING","value","charsChanged","doFinalize","doGetWidgetClassName","this","_createCharContent","getDocument","getChildrenHolderElement","_getCharGroups","charContent","groupDelimiter","getGroupDelimiter","charDelimiter","getCharDelimiter","lines","split","result","i","l","length","chars","push","doCreateSubElements","doc","rootElem","parentElem","_charContentELem","parentNode","removeChild","charGroups","getChars","createElement","ii","groupElem","j","jj","s","trim","charElem","innerHTML","appendChild","X","Event","addListener","_reactCellClick","bind","e","elem","getTarget","tagName","toLowerCase","invokeEvent","innerText","CharSelectorGropButton","DropDownButton","setButtonKind","Button","Kinds","DROPDOWN","PropertyScope","PUBLIC","getPropStoreFieldValue","setChars","setDisplayed","getElement","style","position","addEventListener","reactPanelValueChange","selector","finalize","doGetDropDownWidget","getSelector","stopPropagation","_ready"],"mappings":"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"}